# MBTI性格診断テスト（CREATIVEHACKAWARD10-6）

本番サイト: https://mbti-search-854b363bf31b.herokuapp.com/

AIが動的に生成する質問に答えるだけで、MBTI性格タイプを診断・可視化するWebアプリです。4つの次元（外向性/内向性、感覚/直感、思考/感情、判断/知覚）をもとに回答し、16タイプから最適なタイプを推定します。

## 機能（Features）

### 基本診断機能
- **AI生成質問**: OpenAIで回答内容に応じた物語仕立ての質問を逐次生成
- **物語モード**: 「ホラー」「アドベンチャー」「ミステリー」「クリエイター」から選択
- **進捗管理**: サーバ側セッションモデルで質問位置・回答履歴を保持
- **結果表示**: 各次元のスコアとタイプ名をわかりやすく提示
- **リアルタイム**: 回答に応じて直ちに次の質問・結果へ反映

### AI診断機能
- **詳細分析**: ユーザーの回答と物語設定に基づいた個別化された性格分析
- **音楽提案**: MBTIタイプと物語の文脈に合った音楽ジャンル・アーティスト・楽曲を提案
- **画像生成**: 3つのカテゴリ（抽象的表現、自然・風景、日常シーン）で性格を視覚化
- **プレイリスト作成**: 物語の世界観と性格特性を反映したカスタムプレイリスト

### 物語設定機能
- **カスタム物語**: ユーザーが独自の物語設定（舞台、テーマ、雰囲気、キャラクター背景）を作成可能
- **文脈に応じた生成**: 物語の設定と回答履歴を考慮した個性的なコンテンツ生成
- **多様な表現**: 抽象的なアートから日常シーンまで、様々な角度で性格を表現

## 差別化ポイント（USP）
- **物語モード**: 回答のしやすさが向上し、より自然な性格診断が可能
- **個別化されたAI分析**: 単純なMBTI診断を超えた、ユーザー固有の性格特性分析
- **多面的な表現**: 音楽・画像・物語を通じて性格を多角的に可視化
- **文脈に応じた生成**: 物語設定と回答履歴を考慮した、より個性的なコンテンツ生成
- **自己認識の深化**: MBTIにとどまらず「自己認識・アイデンティティ形成プロセス」を探究
- **AIの再定義**: 「個性の均質化」ではなく「個性の多様化」を促すツールとして活用

## クイックスタート（Quick Start）
```bash
bundle install
bin/rails db:setup
bin/rails s
```
ブラウザで http://localhost:3000 を開きます。

### 環境変数（.env例）
```
OPENAI_API_KEY=sk-xxxxx
```

必要に応じて以下も設定:
- `DATABASE_URL`（本番: PostgreSQL）
- `RAILS_MASTER_KEY`（本番資格情報使用時）

## 技術スタック（Tech Stack）
- **Backend**: Rails 7 / Ruby 3.2.2
- **Frontend**: Turbo / Stimulus / Importmap
- **Database**: 本番 PostgreSQL（Heroku Postgres）/ 開発 SQLite3
- **AI/ML**: OpenAI GPT-4, DALL-E 3
- **主要モデル**: 
  - `MbtiSession`（質問・回答・進行状況・物語モードを保存）
  - `MbtiResult`（MBTIタイプ計算・分析）
- **外部API**: 
  - OpenAI（質問生成・分析・音楽提案・画像生成）
  - DALL-E 3（高品質な画像生成）
- **主要サービス**:
  - `OpenaiService`（質問生成・分析）
  - `AiMusicService`（音楽提案・プレイリスト生成）
  - `AiPhotoService`（画像生成・プロンプト管理）

## 主要機能の詳細

### AI診断システム
- **動的質問生成**: ユーザーの回答履歴と物語設定に基づいて、OpenAIが個別化された質問を生成
- **文脈に応じた分析**: 物語の世界観と回答パターンを考慮した、より深い性格分析
- **多面的な結果表示**: 音楽・画像・物語を通じて性格特性を多角的に表現

### 画像生成システム
- **DALL-E 3統合**: 高品質な画像生成で性格を視覚化
- **3つのカテゴリ**: 抽象的表現、自然・風景、日常シーンで性格を多面的に表現
- **文字禁止機能**: 純粋な視覚コンテンツのみを生成し、文字を含まない画像を保証

### 音楽提案システム
- **個別化された提案**: MBTIタイプと物語設定に基づいた音楽ジャンル・アーティスト・楽曲の提案
- **プレイリスト生成**: 物語の世界観と性格特性を反映したカスタムプレイリストの作成
- **文脈に応じた選曲**: ユーザーの回答履歴と物語の雰囲気を考慮した音楽選択

## 開発メモ（UI/ナビゲーションの注意点）
- **質問UIの安定化**: EIほか全テーマでサイズ・位置の変形を禁止
  - 対応ファイル: `app/assets/stylesheets/mbti_show.scss`, `mbti_themes.scss`
  - hover/selectedのtransformを無効化し、色・影のみトランジション
- **「前の質問」ボタン**: フォーム外に独立配置し、POSTで`/mbti/back`へ送信
  - ルート: `post '/mbti/back' => mbti#back`
  - コントローラ: `back`で`current_question_index`を1つ戻し、303で`/mbti/show`へ
- **CSRF**: 回答系（`answer`, `back`）で検証スキップ（必要に応じて厳密化可）

## 使用例

### 基本的な診断フロー
1. **物語モード選択**: ホラー、アドベンチャー、ミステリー、またはカスタム物語から選択
2. **質問回答**: AIが生成する物語仕立ての質問に回答
3. **結果表示**: MBTIタイプと詳細な分析結果を確認
4. **AI診断**: 音楽・画像生成で性格を多角的に表現

### カスタム物語の作成
- **舞台設定**: 物語の背景となる場所や時代を設定
- **テーマ選択**: 冒険、ロマンス、ミステリーなど物語のテーマを選択
- **雰囲気設定**: 明るい、暗い、神秘的など物語の雰囲気を決定
- **キャラクター背景**: 主人公の背景や特徴を詳細に設定

## APIエンドポイント

### 診断関連
- `GET /mbti` - 診断開始
- `POST /mbti/answer` - 質問回答
- `GET /mbti/result` - 基本結果表示
- `GET /mbti/result_ai` - AI診断結果表示

### AI生成関連
- `POST /mbti/generate_music` - 音楽提案生成
- `POST /mbti/generate_image` - 画像生成
- `POST /mbti/personalized_report` - 個別化レポート生成

## デプロイ（Heroku）
```bash
git push heroku main
heroku run rails db:migrate
```
リリース時に自動マイグレーションを行う場合は `Procfile` に以下を追加:
```
release: bundle exec rails db:migrate
```

## ライセンス
このリポジトリの内容はプロジェクトの目的に従って利用してください。
