# MBTI性格診断テスト（CREATIVEHACKAWARD10-6）

本番サイト: https://mbti-search-854b363bf31b.herokuapp.com/

AIが動的に生成する質問に答えるだけで、MBTI性格タイプを診断・可視化するWebアプリです。4つの次元（外向性/内向性、感覚/直感、思考/感情、判断/知覚）をもとに回答し、16タイプから最適なタイプを推定します。

## 目次
- [アプリケーションの概要](#アプリケーションの概要)
- [システムアーキテクチャ](#システムアーキテクチャ)
- [技術スタック](#技術スタック)
- [主要機能](#主要機能)
- [APIエンドポイント](#apiエンドポイント)
- [開発者向け付録](#開発者向け付録)

---

## アプリケーションの概要

### 目的（Purpose）
自己理解を深める対話的な体験を提供し、MBTIの枠を越えて「物語」「音楽」「画像」を通じて多面的にパーソナリティを可視化します。

### 対象ユーザー（Who）
- 自己分析・キャリア探索・創作インスピレーションを求める個人
- ワークショップやカウンセリングでのアイスブレイクを行うファシリテーター
- 企画・コンテンツ制作におけるアイデア発火装置を求めるクリエイター

### 提供価値（Value Proposition）
- AIが物語文脈に沿って質問を生成し、直感的に回答しやすい
- 結果を静的なラベルではなく、音楽・画像・物語の多層表現として提示
- 回答の蓄積から文脈に沿った解釈・示唆を返すため、自己理解が深まる

### 体験フロー（User Journey）
1. 診断エンジンを選ぶ（クエスチョン方式 / ゲームマスター方式）
2. 物語モードを選ぶ（ホラー / アドベンチャー / ミステリー / クリエイター）
3. 物語調の質問に回答（AIが履歴と設定に応じて次の質問を生成）
4. 結果画面でタイプ傾向と根拠のストーリーを確認
5. 音楽提案・画像生成・レポートで多面的に理解を補強

### 差別化ポイント（USP）
- 物語モードで回答のハードルを下げ、自然な自己開示を促進
- 個別化AI分析により、単純なタイプ分類を超えた意味づけ
- 音楽・画像・物語の多面的な表現で解釈の幅を拡張

### 設計思想（Design Principles）
- ラベル付けではなく、文脈と関係性を重視した解釈
- 説明可能性（根拠の提示）と詩的表現（インスピレーション）の両立
- ユーザー主導（カスタム物語）とAI支援のハイブリッド

### 今後の展望（Roadmap）
- セッションの長期学習（再訪時の継続的パーソナライズ）
- コミュニティ共有用の匿名プロファイル/プレイリスト
- マルチモーダル入力（画像・音声）対応

---

## システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────┐
│                  ユーザー（ブラウザ）                      │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                Controller層                              │
│  MbtiController: リクエスト受付・セッション管理・画面遷移   │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                Service層                                 │
│  ┌──────────────────────────────────────────────────┐   │
│  │  OpenaiService: AI質問生成・分析（メイン）          │   │
│  │    ├── OpenaiPrompts: プロンプトテンプレート管理    │   │
│  │    ├── OpenaiParsers: レスポンスパーサー           │   │
│  │    └── OpenaiFallbacks: API障害時のフォールバック   │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────┐   │
│  │  StoryContextBuilder: 物語フェーズ・コンテキスト構築 │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────┐  ┌──────────────────┐            │
│  │ AiMusicService   │  │ AiPhotoService    │            │
│  │ 音楽提案生成      │  │ 画像生成（DALL·E） │            │
│  └──────────────────┘  └──────────────────┘            │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                Model層                                   │
│  ┌──────────────────┐  ┌──────────────────┐            │
│  │ MbtiSession      │  │ MbtiResult       │            │
│  │ セッション管理    │  │ タイプ計算・分析  │            │
│  │ (キャッシュベース) │  │                  │            │
│  └──────────────────┘  └──────────────────┘            │
│  ┌──────────────────┐                                   │
│  │ MbtiQuestion     │                                   │
│  │ 質問データ構造    │                                   │
│  └──────────────────┘                                   │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│            キャッシュストア（Redis）                       │
│  セッションデータの一時保存（24時間有効）                    │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│            OpenAI API                                    │
│  GPT-4o-mini: 質問生成・分析                              │
│  DALL·E 3: 画像生成                                      │
└─────────────────────────────────────────────────────────┘
```

### 物語フェーズ管理（StoryContextBuilder）

物語は5つのフェーズで進行し、各フェーズで異なるMBTI次元を戦略的に測定：

| フェーズ | 問題番号 | 緊張度 | 測定次元 |
|---------|---------|--------|---------|
| Opening（導入） | 1-2 | Low | EI, SN |
| Rising（上昇） | 3-5 | Building | TF, JP, SN |
| Climax（クライマックス） | 6-8 | High | EI, TF, JP |
| Falling（下降） | 9-10 | Resolving | SN, JP, TF |
| Resolution（結末） | 11-12 | Conclusion | TF, EI |

---

## 技術スタック

### バックエンド
- **Ruby**: 3.3.0
- **Rails**: 8.0.2+
- **キャッシュ**: Redis（セッション管理）

### フロントエンド
- **Turbo / Stimulus**: Hotwireによるリアクティブ更新
- **Importmap**: ESモジュール管理
- **SCSS**: スタイリング

### AI/外部サービス
- **OpenAI GPT-4o-mini**: 質問生成・分析・音楽提案
- **DALL·E 2**: 画像生成

### 主要Gem
- `ruby-openai`: OpenAI API連携
- `redis`: キャッシュストア
- `turbo-rails` / `stimulus-rails`: Hotwire
- `dotenv-rails`: 環境変数管理
- `sassc-rails`: SCSS

---

## 主要機能

### 診断エンジン

#### クエスチョン方式
- AIが物語調の質問を生成
- フェーズに応じた緊張度と次元の戦略的選択
- 累積コンテキストによる物語の連続性維持

#### ゲームマスター方式
- インタラクティブな物語体験
- 選択に応じて変化するストーリー展開
- 進捗ベースのエンディング生成

### 物語モード
| モード | 雰囲気 |
|--------|--------|
| Horror | 暗い夜道、古い屋敷、謎めいた出来事 |
| Adventure | 未知の土地、宝物探し、危険な挑戦 |
| Mystery | 謎めいた事件、隠された真実、複雑な人間関係 |
| Creator | ユーザー定義のカスタム物語設定 |

### AI診断機能
- **詳細分析**: 回答パターンに基づくタイプ解説
- **パーソナライズドレポート**: 物語文脈での診断理由・成長のヒント
- **音楽提案**: MBTIタイプに基づくジャンル・アーティスト・楽曲提案
- **画像生成**: 性格を表現する抽象・風景・日常シーン

---

## APIエンドポイント

### 診断フロー
| Method | Path | 説明 |
|--------|------|------|
| GET | `/mbti` | 診断開始（セッションID発行） |
| GET | `/mbti/mode_selection` | エンジン選択画面 |
| GET | `/mbti/select_mode` | 物語モード選択画面 |
| POST | `/mbti/set_mode` | モード設定・診断開始 |
| GET | `/mbti/make_mode` | カスタム物語作成画面 |
| POST | `/mbti/create_story` | カスタム物語保存 |
| GET | `/mbti/show` | 質問表示 |
| POST | `/mbti/answer` | 回答送信 |
| POST | `/mbti/back` | 前の質問に戻る |
| GET | `/mbti/result` | 基本結果表示 |
| GET | `/mbti/result_ai` | AI診断結果表示 |
| GET | `/mbti/resume` | 診断再開 |

### ゲームマスター方式
| Method | Path | 説明 |
|--------|------|------|
| GET | `/mbti/game_master` | ゲームマスター画面 |
| POST | `/mbti/game_master/answer` | 選択送信 |
| GET | `/mbti/game_master/ending` | エンディング表示 |

### AI生成API
| Method | Path | 説明 |
|--------|------|------|
| POST | `/mbti/analyze` | 詳細分析生成 |
| POST | `/mbti/personalized_report` | パーソナライズドレポート生成 |
| POST | `/mbti/generate_music` | 音楽提案生成 |
| POST | `/mbti/generate_image` | 画像生成 |

---

## 開発者向け付録

### 要件
- Ruby: 3.3.0
- Rails: 8.0系
- Redis: キャッシュストア
- OpenAI API Key

### クイックスタート

```bash
bundle install
bin/rails s
```

ブラウザで http://localhost:3000 を開きます。

### 環境変数

`.env`で管理：

```bash
OPENAI_API_KEY=sk-xxxxx
REDIS_URL=redis://localhost:6379/0  # 本番環境用
```


### 補助ドキュメント
- `MBTI_README.md`: 差別化ポイントの要約
- `docs/production.txt`: 本番運用メモ
- `docs/2024.txt`: 開発履歴


## ライセンス

このリポジトリの内容はプロジェクトの目的に従って利用してください。
